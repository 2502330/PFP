<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Clean Blog - Start Bootstrap Theme</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <script>
            const MOVIES_PER_PAGE = 20;
let allMovies = [];
let filteredMovies = [];
let currentPage = 1;
let allGenres = new Set();

function renderMovieCard(movie, idx) {
    return `
    <div class="movie-card-4th mb-4">
        <div class="card h-100">
            <img src="${movie.poster || ''}" class="card-img-top" alt="${movie.name || 'No Title'}" style="height:140px;object-fit:cover;">
            <div class="card-body">
                <h5 class="card-title">${movie.name || 'No Title'}</h5>
                <p class="card-text"><strong>Genres:</strong> ${(movie.genres || []).join(', ')}</p>
                <p class="card-text"><strong>Release Date:</strong> ${movie.date_published || ''}</p>
                <p class="card-text"><strong>Rating:</strong> ${movie.rating || ''}</p>
                <button class="btn btn-primary mt-2" onclick="showReviewsByIndex(${idx})">Read Reviews</button>
            </div>
        </div>
    </div>
    `;
}

function renderPagination(totalPages, currentPage) {
    let html = `<nav aria-label="Movie catalog pagination"><ul class="pagination justify-content-center">`;

    // Add "Previous" button
    if (currentPage > 1) {
        html += `<li class="page-item">
            <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
        </li>`;
    }

    // Determine the range of pages to display
    let startPage = Math.max(1, currentPage - 2); // Show 2 pages before the current page
    let endPage = Math.min(totalPages, currentPage + 2); // Show 2 pages after the current page

    // Adjust range if near the beginning or end
    if (currentPage <= 3) {
        endPage = Math.min(5, totalPages);
    } else if (currentPage >= totalPages - 2) {
        startPage = Math.max(1, totalPages - 4);
    }

    // Generate page links
    for (let i = startPage; i <= endPage; i++) {
        html += `<li class="page-item${i === currentPage ? ' active' : ''}">
            <a class="page-link" href="#" data-page="${i}">${i}</a>
        </li>`;
    }

    // Add "Next" button
    if (currentPage < totalPages) {
        html += `<li class="page-item">
            <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
        </li>`;
    }

    html += `</ul></nav>`;
    return html;
}

function filterMovies() {
    const search = document.getElementById('searchInput').value.trim().toLowerCase();
    const genre = document.getElementById('genreFilter').value;
    const minYear = parseInt(document.getElementById('minYear').value, 10);
    const maxYear = parseInt(document.getElementById('maxYear').value, 10);
    const rating = parseFloat(document.getElementById('ratingFilter').value);

    filteredMovies = allMovies.filter(movie => {
        // Search by title
        if (search && !(movie.name || '').toLowerCase().includes(search)) return false;
        // Filter by genre
        if (genre && (!movie.genres || !movie.genres.includes(genre))) return false;
        // Filter by year
        const year = movie.date_published ? parseInt(movie.date_published.slice(0,4), 10) : null;
        if (!isNaN(minYear) && year && year < minYear) return false;
        if (!isNaN(maxYear) && year && year > maxYear) return false;
        // Filter by rating
        if (!isNaN(rating) && movie.rating < rating) return false;
        return true;
    });
    showPage(1);
}

function showPage(page) {
    const catalog = document.getElementById('movieCatalog');
    const pagination = document.getElementById('pagination');
    const totalPages = Math.ceil(filteredMovies.length / MOVIES_PER_PAGE) || 1;

    // Ensure the page number is within valid bounds
    if (page < 1 || page > totalPages) {
        alert(`Please enter a valid page number between 1 and ${totalPages}.`);
        return;
    }

    currentPage = page;

    const start = (page - 1) * MOVIES_PER_PAGE;
    const end = start + MOVIES_PER_PAGE;
    const moviesToShow = filteredMovies.slice(start, end);

    if (catalog) {
    catalog.innerHTML = moviesToShow.map((movie, idx) => renderMovieCard(movie, start + idx)).join('');
}
    if (pagination) {
        pagination.innerHTML = renderPagination(totalPages, page);
        pagination.querySelectorAll('.page-link').forEach(link => {
            link.onclick = function (e) {
                e.preventDefault();
                showPage(Number(this.dataset.page));
            };
        });
    }
}

// Add event listener for the "Go to Page" input and button
document.addEventListener('DOMContentLoaded', function () {
    const goBtn = document.getElementById('goPageBtn');
    const pageInput = document.getElementById('pageInput');

    if (goBtn && pageInput) {
        // Handle "Go" button click
        goBtn.onclick = function () {
            const val = parseInt(pageInput.value, 10);
            if (!isNaN(val)) {
                showPage(val);
            } else {
                alert('Please enter a valid page number.');
            }
        };

        // Handle "Enter" key press in the input field
        pageInput.onkeydown = function (e) {
            if (e.key === 'Enter') {
                const val = parseInt(pageInput.value, 10);
                if (!isNaN(val)) {
                    showPage(val);
                } else {
                    alert('Please enter a valid page number.');
                }
            }
        };
    }
});

fetch('assets/imdb.json')
    .then(res => res.json())
    .then(data => {
        allMovies = Object.values(data).filter(m => m && m.name);
        // Collect all genres
        allMovies.forEach(m => (m.genres || []).forEach(g => allGenres.add(g)));
        // Populate genre filter
        const genreFilter = document.getElementById('genreFilter');
        if (genreFilter) {
            Array.from(allGenres).sort().forEach(g => {
                const opt = document.createElement('option');
                opt.value = g;
                opt.textContent = g;
                genreFilter.appendChild(opt);
            });
        }
        filteredMovies = allMovies;
        showPage(1);
    })
    .catch(() => {
        const catalog = document.getElementById('movieCatalog');
        if (catalog) {
            catalog.innerHTML = '<div class="col-12 text-center">Failed to load movies.</div>';
        }
    });

function showReviews(reviews, movieName) {
    const modalLabel = document.getElementById('reviewsModalLabel');
    const modalBody = document.getElementById('reviewsModalBody');
    modalLabel.textContent = `Reviews for ${movieName}`;
    if (reviews && reviews.length > 0) {
        modalBody.innerHTML = `<ul>${reviews.map(r => `<li class="mb-3">${r}</li>`).join('')}</ul>`;
    } else {
        modalBody.innerHTML = '<p>No reviews available.</p>';
    }
    const modal = new bootstrap.Modal(document.getElementById('reviewsModal'));
    modal.show();
}

function showReviewsByIndex(idx) {
    const movie = filteredMovies[idx];
    showReviews(movie.reviews || [], movie.name || 'No Title');
}

// Event listeners for filters
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('searchInput').addEventListener('input', filterMovies);
    document.getElementById('genreFilter').addEventListener('change', filterMovies);
    document.getElementById('minYear').addEventListener('input', filterMovies);
    document.getElementById('maxYear').addEventListener('input', filterMovies);
    document.getElementById('ratingFilter').addEventListener('change', filterMovies);
});
</script>
        <style>
            #movieCatalog {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center; /* This centers the cards horizontally */
}
.movie-card-4th {
    flex: 0 0 48%;
    max-width: 48%;
    min-width: 180px;
    box-sizing: border-box;
}
@media (max-width: 900px) {
    .movie-card-4th { flex: 0 0 100%; max-width: 100%; }
}
.card-img-top {
    width: 100%;
    height: 220px;           /* Fixed height for all images */
    object-fit: cover;       /* Crop and fill the area */
    object-position: center; /* Center the image */
    background: #222;        /* Optional: fallback background */
}
</style>
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">Movie Reviews</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="catalog.html">Catalog</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="recommendations.html">Recommendations</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/about-bg.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="page-heading">
                            <h1>Catalog</h1>
                            <span class="subheading">Catalog of movies.</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main class="mb-4">
            <div class="container my-5">
                <div class="row mb-4">
                <div class="col-md-3 mb-2">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search by title...">
                </div>
                <div class="col-md-3 mb-2">
                    <select id="genreFilter" class="form-select">
                    <option value="">All Genres</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <select id="minYear" class="form-select">
                        <option value="">Min Year</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <select id="maxYear" class="form-select">
                        <option value="">Max Year</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <select id="ratingFilter" class="form-select">
                    <option value="">All Ratings</option>
                    <option value="9">9+</option>
                    <option value="8">8+</option>
                    <option value="7">7+</option>
                    <option value="6">6+</option>
                    <option value="5">5+</option>
                    </select>
                </div>
                </div>
                <div id="movieCatalog">
                    <!-- Movie cards will be injected here by JS -->
                </div>
                <div id="pagination" class="mt-4"></div>
                <div id="pagination" class="mt-4"></div>
                <div class="d-flex justify-content-center mt-2">
                    <input type="number" id="pageInput" class="form-control me-2" placeholder="Go to page..." style="width: 120px;">
                    <button id="goPageBtn" class="btn btn-primary">Go</button>
                </div>
            </div>
        </main><!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="#!">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="#!">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="#!">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Your Website 2023</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- Reviews Modal -->
        <div class="modal fade" id="reviewsModal" tabindex="-1" aria-labelledby="reviewsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header">
                        <h5 class="modal-title" id="reviewsModalLabel">Reviews</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="reviewsModalBody">
                        <!-- Reviews will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
